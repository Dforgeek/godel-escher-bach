# Guide for contributors

Для того, чтобы помочь добавить очередную главу в данную репродукцию, адаптируйте сырой текст под существующий стиль книги и проверьте себе по следующему списку.

## Checklist

- [ ] Обернуть название главы (`\chapter{название главы}`), без указания номера.
- [ ] Обернуть все подразделы (`\subsection{подраздел}`) и отделить их от предыдущего текста двумя пустыми строками.
- [ ] Убрать большинство имеющихся неразрывных пробелов (`~`), стоящих в неподходящих местах. Например, иногда пробелы(`~`) почему-то стоят между обычными большими словами и абсолютно не помогают (а скорее очень мешают) компоновке параграфов.
- [ ] Убрать пробелы после `\emph{}` и подобных комманд (видимо, это артефакт pandoc). Например: "`\emph{...} ,`" (обратите внимание на пробел перед запятой). Может помочь регулярка `r"\} [.,!?]"`.
- [ ] Расставить неразрывные пробелы (~) в нужных местах:
    * https://tex.stackexchange.com/q/15547
    * Во фразах типа `Рис.~42` (корректнее: `Рис.~\ref{...}`)
    * Перед числами (см. исключения выше)
    * Перед короткими математическими формулами (`~$x$`, см.искл.)
    * После предлога-отрицания "не" в тех фразах, где возможно искажения восприятия при отрыве (line-break) отрицания от позитивной части (например, "не~должно").
    * Перед короткими обозначениями, выделяемыми жирным шрифтом (например, "система~\textbf{pr}", "режим~\textbf{M}").
    * Сокращение "и так далее": "и~т.\,д." (неразрывный+маленький пробел)
    * Сокращение "и прочее": "и~пр." (неразрывный пробел)
    * Сокращение "так как": "т.\,к." (маленький пробел)
    * Между инициалами и фамилией ("М.К.~Эшер"). На текущий момент принято решение, что "маленький пробел" между инициалам (типа "М.\,К.~Эшер") НЕ добавляем.
    * После/перед очень короткими словами (одно/двух-буквенными) в начале/конце предложения (например: "В~этом...", "...~бы.").
- [ ] Заменить все тире на "\---" (см. пакет extdash). Обычно тире в сыром тексте представлены в виде "---" или " - ".
- [ ] Заменить математические выражения, представленные в виде \emph{x}, на полноценные inline-формулы ($x$) (не забыть пробелы, если это нужно!).
- [ ] Заменить математические операции на совокупность текста и математики:
    * "`1 x 1`" на "`1 $\times$ 1`" (из математики здесь только один символ, поэтому цифры пишутся текстом)
    * "`2 + 3 = 5`" на "`$2 + 3 = 5$`" (здесь всё выражение является математическим, поэтому стоит его полностью затолкать в `$...$`)
    * Стоит учитывать, что числа в тексте и числа в математике отображаются по-разному (т.к. текст набирается шрифтом libertine, а математика - newtxmath). Поэтому стоит стремиться сделать все числа в одном стиле (например, текстом), используя формулы по минимуму. Противоположный вариант: оборачивать ВСЕ числа в `$\num{42}$`. Архитектурное решение по данному вопросу ещё не принято.
- [ ] Пофиксить все формулы, описывающие "строчки с тире" — на текущий момент принят следующий стиль: вся "строчка" пишется в `\textbf{...}`, "вариабельные" части пишутся в виде математических символов (`$x$`), тире пишутся в виде "`--`", между тире ставится "`{}`" (чтобы токены тире не сливались и не интерпретировались иначе). Например: `\textbf{$xy$ND$x$}`, `\textbf{--{}--u--r--{}--}`.
- [ ] Привести в порядок display-формулы (изначально представлены в виде мусора, нужно собирать формулы вручную) в виде `\[ big-math-expression \]`.
- [ ] Расставить `\@` перед точками после БОЛЬШИХ СЛОВ в конце предложений (например, "`... строчки ТТЧ\@.`") (см. https://tex.stackexchange.com/a/22563/216486).
- [ ] Обернуть все блоки с описание правил/теорем/аксиом и прочего в `\begin{mybox}{ТИТУЛЬНИК}...\end{mybox}` (обратите внимание на один обязательный аргумент). На текущий момент такие блоки рендерятся с помощью tcolorbox. Не рекомендуется использовать mybox для блоков с каким-либо другим смыслом: в таких случаях стоит определить отдельное новое окружение (\newenvironment, \newtcolorbox, \newcommand).
- Обернуть все "микро-блоки" в тексте в `\begin{block}...\end{block}`. В этом окружении текст имеет hanging indent (размера \parindent) и небольшой вертикальный отступ (6pt, настраивается в опциональном аргументе) сверху/снизу. В оригинале часто встречаются такие блоки текста между параграфами — пока что стоит их просто оборачивать в block-env.
 [ ] Обернуть все центрированные куски текста в `\begin{center}...\end{center}`. Возможная альтернатива (для параграфов текста): `\begin{block}\centering...\end{block}`.
- [ ] Обернуть все блоки текста, похожие на списки без лейблов и без какого-либо выравнивания в `\begin{itemize}[label={}, noitemsep, topsep=6pt, leftmargin=\parindent]...\item Text...\end{itemize}`.
- [ ] Обернуть все блоки текста, похожие на списки с выравниванием (лейблов или текста) в соответствующие itemize. При повторении таких списков стоит определить новый стиль списка.
- [ ] Обернуть все блоки текста, похожие на списки с нумерацией `\begin{enumerate}[label=(\arabic*), noitemsep, topsep=6pt]...\item First...\end{enumerate}`.
- [ ] Обернуть все коаны в `\begin{koan}...\end{koan}`. На текущий момент это окружение рендерится в tcolorbox и объявлено ТОЛЬКО ЛОКАЛЬНО в 9 диалоге и 9 главе. Для повторного использования стоит скопировать это определение в другую главу, при необходимости модифицировав под стиль той главы.
- [ ] Добавить сторонние иллюстрации (не "рисунки автора"):
    * Найти оригинал (или что-то максимально похожее) в максимальном разрешении, положить в папку `img/orig/`.
    * Создать файл `img/psd/<illustration>.psd`.
    * Произвести необходимое редактирование (crop,trim,upscale,colorize), сохранить промежуточные результаты и варианты в слоях.
    * Экспортировать `image.png` в `img/`. Максимальная ширина/высота: 1000px. Если размер всё ещё почему-то больше 1мб, то желательно как-то уменьшить.
    * Желательно запустить `optipng -o7 image.png`.
    * Закоммитить ТОЛЬКО `img/image.png`.
- [ ] Добавить "рисунки автора":
    * Если это сложная картинка, то сделать скриншот в максимально возможном разрешении, либо экспортировать целую страницу из djvu в png и вырезать картинку оттуда. Затем: см. выше.
    * Если это какая-либо диаграмма, то реализовать (заTeXать) её нативно с помощью TikZ или других сторонних пакетов. Например: деревья, графы, микро-рисунки, блок-схемы, диаграммы Феймана, МУ.
- [ ] Шаблон для вставки иллюстраций:
    ```tex
    \adjustimage{
        max width=\textwidth,
        %max totalheight=\textheight-\baselineskip-\abovecaptionskip-\belowcaptionskip-3pt,
        center,
        caption={М.К.~Эшер «Какой-то рисунок» (литография, 2022)},
        label={fig:LABEL},
        figure,
    }{IMAGE.png}
    ```
    * Для иллюстраций, занимающих всю высоту страницы, нужно раскомментировать `max totalheight`.
    * Для иллюстраций, занимающих всю ширину, но которые желательно сделать чуть меньше, нужно использовать `max width=0.9\textwidth`.
    * Для илюстраций, которые имеют маленький размер в оригинале, но которые хочется (и вы уверены!) сделать чуть больше, нужно использовать `width=5cm` (подогнать вручную).
    * Использование в тексте: "`рис.~\ref{fig:LABEL}`".
